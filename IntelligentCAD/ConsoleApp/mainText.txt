Аннотация: В данной статье рассматривается устройство системы приборного учета, которая может поддерживать неограниченное число моделей приборов учета. 
Ключевые слова: Приборный учет, распределенные системы
Введение.
В современном мире деятельность человека неразрывно связана с потреблением коммунальных ресурсов, таких как вода, газ , электричество и т.д. В связи с этим требуется контролировать потребление и данные используемых ресурсов. Для данных целей используются приборы учета: специальные счетчики и расходомеры. Обычно показания учитываемых ресурсов можно получить с дисплея прибора, но для этого нужно иметь доступ к данному прибору, что вынуждает человека обходить места установки и вручную записывать данные со счетчиков. Поэтому широкое распространение получают приборы, поддерживающие взаимодействие с персональным компьютером.    
С использованием данных типов приборов стали создаваться системы, которые собирают показания и сохраняют их в общее хранилище данных. Однако данные системы поддерживают либо только один тип, либо одну модель приборов, что сильно ограничивает в выборе типа ресурса. Это объясняется тем, что приборы чаще всего поддерживают учет только одного ресурса. Чтобы решить данную проблему, была создана система приборного учета, которая может поддерживать неограниченное число различных моделей приборов.
Система приборного учета состоит из 3 основных модулей: системы сбора показаний, система синхронизации данных, система взаимодействия с пользователем. 
В целом систему схематически можно изобразить так:


Система сбора показаний
Система сбора показаний подразумевает подключение к ней множества приборов учета ресурсов. Так как приборы не обладают единым протоколом  обмена и значительно различаются по набору команд и алгоритму опроса, вводится прослойка, описывающая структуру пакета данных подключаемой модели. На основе описания строиться система команд прибора.  Кроме того, счетчики могут иметь различные интерфейсы для передачи данных. Для этого в системе реализуется множество методов связи с прибором и могут использоваться для опроса. Все коннекторы реализуются таким образом, чтобы для работы использовались 4 основных операции: установка связи или открытие сеанса связи, отправка пакета данных, получение данных и закрытие сеанса связи. 


На основе “системы команд” строится “система опроса” показаний конкретного прибора(рис 2 уровень 3). Команды вызываются в определенном порядке, чтобы получить архивные(часовые, суточные, месячные) и итоговые. Система опроса показаний считывает показания с прибора и конвертирует в унифицированный формат представления данных для глобальной системы сбора показаний. Каждое средство взаимодействия имеет абстракцию коннектора, которая описывает основные операции коннектора. Это сделано таким образом, чтобы было возможно обращаться к прибору через любой доступный интерфейс или средство связи, которое поддерживает прибор.
Уровень 3 системы сбора показаний введена, чтобы учесть различные способы подключения приборов к системе. Каждый вариант подключения прибора выносится в отдельную “фабрику”. При обращении к методу фабрики, возвращается экземпляр системы сбора показаний.
Уровень 4 или глобальная система сбора показаний имеет список всех доступных систем опроса показаний для каждого прибора в различных вариациях подключения. В  базе данных опроса задаются приборы, которые добавлены в глобальной базе данных и переносятся с помощью системы синхронизации данных. Каждый экземпляр типа прибора имеет свое символьное имя, использующееся в опросе. Для всех типов приборов с конкретным подключением существует соответствующее ему символьное имя. На совпадении символьных имен экземпляра прибора и имени прибор-подключение определяется какой прибор необходимо опрашивать. Для каждого прибора создается отдельный поток, который задается в настройках экземпляра прибора в системе взаимодействия с пользователем. 

Система синхронизации данных
Система синхронизации данных состоит из 2 основных составляющих, это WCF-служба, устанавливаемая на стороне основной (глобальной) базы данных, и служба-транслятор, устанавливаемая на стороне базы опроса. За счет диалога этих двух элементов производится синхронизация данных.
WCF-служба, если рассматривать в общем случае, имеет 4 основных функции: получение настроек и информации о приборах, которые должны быть опрошены на данном сервере опроса, передача показаний конкретного прибора, передача данных о внештатных ситуациях, возникающий в процессе работы прибора или в период его опроса, передача константных значений прибора, необходимые для формирования отчеты и других математических операций. 
Служба транслятор, ссылаясь на  WCF-службу, выполняет доступные функции и сохраняет данные в бд или загружает их для передачи данных.

Средства взаимодействия с пользователем.
Средства взаимодействия с пользователем включает в себя как веб-приложение, так и мобильное приложение. Оно содержит всю подробную информацию о типах приборов, самих приборах, подробной информации об месте и формате установки, а также их показаниях. Доступ к ним получают все пользователи, зарегистрированные в системе, относящиеся к какой-либо организации и список доступных приборов, привязанные к находящимся в управлении домам. Средства взаимодействия с пользователем ключают в себя множество функций для взаимодействия с системами опроса, позволяет формировать  отчеты на основе показаний приборов.

Добавление прибора и его опрос с передачей данных на основной сервер.
Добавление прибора и настройка производится в каком-либо средстве взаимодействия с пользователем. Первоначально необходимо добавить модель данного устройства и переменные, которые он может считывать. Следующим шагом добавляются информация о коннекторах данного прибора, иначе говоря настройка интерфейсы, через которые может осуществляться связь. Затем возможно добавить экземпляр на основе созданной модели прибора с привязкой к организации и к дому организации, а также с указанием коннектора и параметров, необходимых для связи. После добавления устройство готово к опросу. 
С помощью системы синхронизации данные о добавленном приборе переносятся на сервер опроса, где в свою очередь производится его опрос. Однако опрос данного устройства возможен, если реализована алгоритм опроса для этой модели с установленным в интерфейсе коннектором коннектором. 
Система опроса загружает новый прибор, добавленный в систему. Система опроса производит опрос периодически. Период опроса задается в настройках средства взаимодействия с пользователем. После опроса, показания заносятся в базу системы опроса. Затем они передаются системой синхронизации на основной сервер. После синхронизации показания становятся доступны пользователю. 

Вывод: в статье было рассмотрено система приборного учета. Рассмотренный подход, реализованный в системе, обеспечивает универсальность в выборе типов и моделей приборов, а перенос нагрузки при опросе значительно уменьшает нагрузку на основном сервере.

